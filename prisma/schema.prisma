generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model merchant {
  id                    String                    @id @default(uuid())
  reference             String
  email                 String
  liveOn                DateTime
  disbursementFrequency disbursementFrequencyType
  minimumMonthlyFee     Float // todo: change to decimal same as order
  orders                order[]

  //Audit
  createdAt DateTime  @default(now()) @db.Timestamptz(6)
  updatedAt DateTime  @updatedAt @db.Timestamptz(6)
  deletedAt DateTime? @db.Timestamptz(6)

  @@unique([id, reference, email])
}

model order {
  id              String   @id @default(uuid())
  externalId      String
  merchantId      String
  amount          Decimal  @db.Decimal(12, 2)
  transactionDate DateTime
  processed       Boolean  @default(false)
  processedAt     DateTime

  //Audit
  createdAt DateTime  @default(now()) @db.Timestamptz(6)
  updatedAt DateTime  @updatedAt @db.Timestamptz(6)
  deletedAt DateTime? @db.Timestamptz(6)

  merchant merchant @relation(fields: [merchantId], references: [id])

  @@unique([externalId, merchantId])
  @@index([merchantId])
}

enum disbursementFrequencyType {
  WEEKLY
  DAILY
}
